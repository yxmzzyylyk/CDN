!function s(n,d,r){function l(t,e){if(!d[t]){if(!n[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=d[t]={exports:{}};n[t][0].call(a.exports,function(e){return l(n[t][1][e]||e)},a,a.exports,s,n,d,r)}return d[t].exports}for(var u="function"==typeof require&&require,e=0;e<r.length;e++)l(r[e]);return l}({1:[function(e,t,i){"use strict";function o(){this._page_modules={};var o=this;this.loaded=0,this.onMessage(function(e){if(e.data&&e.data.type)switch(e.data.type){case"iframe-loaded":e.data.pid&&(o.pid=e.data.pid),o.postMessage({type:"modules",preID:o.preID?o.preID:0}),o.renderModules(),o.notice("开始初始化模块工具"),o.preID=0;break;case"iframe-reload":o.iframeLoading();break;case"wpcom-tool-loaded":o.iframeLoaded();var t=o.loaded?"加载完成":"All done! 欢迎使用可视化编辑器";o.notice(t,"success",2e3),o.loaded=1,jQuery(".ve-header-submit").removeClass("loading");break;case"wpcom-panel":o.editModule(e.data.module,e.data.parent);break;case"close-wpcom-panel":jQuery("#wpcom-panel").removeClass("active");break;case"close-module-list":jQuery(".ve-header-add, #ve-modules").removeClass("active");break;case"save-module":var i=Object.assign({},e.data.module);o._module=e.data.module,i.type="save-module",i.settings={},o.editModule(i)}}),this.init()}o.prototype={init:function(){var a=this;this.iframeLoading(),jQuery(document).on("click",".j-modal-close",function(){jQuery("#wpcom-panel").removeClass("active")}).on("click",".ve-header-add",function(){jQuery("#ve-modules").length&&jQuery(".ve-header-add, #ve-modules").toggleClass("active")}).on("click",".ve-header-setting",function(){var e=jQuery("#wpcom-panel");a.module&&"page-setting"===a.module.type&&e.hasClass("active")?e.removeClass("active"):a.editModule({type:"page-setting",settings:_panel_options.settings})}).on("click",".j-modal-submit",function(){var e=jQuery(this);if(e.hasClass("loading"))return!1;var t=e.text();e.text(e.data("loading-text")).addClass("loading").data("text",t),"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();var i=jQuery("#wpcom-panel").find("form.wpcom-modal-body").serialize().replace(/\'/g,"%27").replace(/\+/g,"%20");i=a.dataFilter(i);var o="";"save-module"===a.module.type?a.saveToMyModule(i,function(){e.removeClass("loading").text(e.data("text"))}):o="page-setting"===a.module.type?(a.saveSetting(i,function(){e.removeClass("loading").text(e.data("text"))}),"正在提交预览页面设置..."):(a.saveModule(i,function(){e.removeClass("loading").text(e.data("text"))}),"正在提交预览模块设置..."),o&&a.notice(o),window.onbeforeunload=function(){return"确定离开当前页面吗？"}}).on("click",".ve-header-mobile",function(){jQuery(".ve-header-pc").removeClass("active"),jQuery(this).addClass("active"),jQuery(".ve-iframe-inner").addClass("mobile"),vm.$children[0].device="mobile"}).on("click",".ve-header-pc",function(){jQuery(".ve-header-mobile").removeClass("active"),jQuery(this).addClass("active"),jQuery(".ve-iframe-inner").removeClass("mobile"),vm.$children[0].device="pc"}).on("click",".ve-header-submit",function(){var t=jQuery(this);if(t.hasClass("loading"))return!1;a.iframeLoading(),t.addClass("loading"),a.notice("正在提交更新发布..."),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpcom_ve_save",id:a.pid,data:JSON.stringify(a.getData(a.pid)),settings:JSON.stringify(_panel_options.settings),nonce:jQuery("#ve-nonce").val()},dataType:"json"}).then(function(e){a.iframeLoaded(),t.removeClass("loading"),window.onbeforeunload=null,a.notice(e.msg,0==e.result?"success":"error",2e3)},function(){a.notice("提交失败，请重试！","error",2e3),a.iframeLoaded(),t.removeClass("loading")})})},iframeLoaded:function(){var e=document.getElementsByClassName("ve-loading");e.length&&e[0].classList.remove("active")},iframeLoading:function(){var e=document.getElementsByClassName("ve-loading");e.length&&e[0].classList.add("active")},renderModules:function(){if(document.getElementById("ve-modules"))return!1;var e=document.createElement("div");e.id="ve-modules";var t=document.createElement("div");t.classList.add("mod-wrap");var i="";if(_modules)for(var o in _modules){var a=_modules[o];if(a&&a.name){a.icon=a.icon?a.icon:"gear";var s=a.icon.split(":"),n='<i class="fa fa-'+a.icon+'"></i>';s&&s[1]&&"mti"===s[0]&&(n='<i class="mod-item-icon material-icons">'+s[1]+"</i>"),i+='<div class="mod-item" data-type="'+o+'">'+n+a.name+"</div>"}}t.innerHTML=i,e.appendChild(t),document.body.appendChild(e)},editModule:function(e,t){var i=jQuery("#wpcom-panel");this.module=e,this._parent=t,i.hasClass("active")?(i.removeClass("active"),setTimeout(function(){i.trigger("module.edit",e).addClass("active")},200)):i.trigger("module.edit",e).addClass("active")},saveModule:function(s,n){if("my-module"===this.module.type){var d=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpcom_get_module",id:s.mid,mid:this.module.id},dataType:"json"}).then(function(e){if(e.data){var t=1,i={fullwidth:"全宽模块","sidebar-layout":"边栏布局模块",gird:"栅格模块"};for(var o in e.data)if(d._parent&&i[e.data[o].type]){var a="嵌套错误：本次添加的模块含有"+i[e.data[o].type]+"，而目标位置处于"+(2===d._parent?"栅格模块":"其他模块（如全宽、栅格模块）")+"内！";d.notice(a,"error",3e3),t=0,d.postMessage({type:"remove-module",module:d.module.id}),jQuery("#wpcom-panel").removeClass("active"),void 0!==n&&n();break}t&&"1"==s.type?(e.data[0].id=d.module.id,d.postMessage({type:"insert-module",modules:e.data,target:d.module.id}),setTimeout(function(){void 0!==n&&n(),setTimeout(function(){jQuery("#wpcom-panel").removeClass("active")},200)},300)):t&&d._saveModule(s,n)}else 0!=s.result&&d.notice("模块获取失败，请重试！","error",2e3)},function(){d.notice("模块获取失败，请重试！","error",2e3)})}else this._saveModule(s,n)},_saveModule:function(e,t){var i=this.getData(this.pid),o=this;this.module.settings.modules?e.modules=this.module.settings.modules:this.module.settings.girds&&(e.girds=this.module.settings.girds),this.module=Object.assign(this.module,{settings:e});var a=this.updateModules(this.module,i);a&&this.setData(this.pid,a,function(){o.preID=o.module.id,o.postMessage({type:"preview"}),setTimeout(function(){void 0!==t&&t(),setTimeout(function(){jQuery("#wpcom-panel").removeClass("active")},200)},400)})},saveToMyModule:function(o,a){var e=0,s=this;""===o.title&&(e=1,jQuery("#wpcom_title").addClass("err").off("change.save").on("change.save",function(){jQuery(this).removeClass("err")})),""===o.type&&(e=1,jQuery("#wpcom_type > div").addClass("err").parent().parent().find('input[name="type"]').off("change.save").on("change.save",function(){jQuery("#wpcom_type > div").removeClass("err")})),e?void 0!==a&&a():(s.notice("正在提交保存我的模块..."),jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"wpcom_save_module",title:o.title,desc:o.desc,module:JSON.stringify(this._module)},dataType:"json"}).then(function(e){if(e.id){var t=_modules["my-module"];if(t.options[0].mid&&(t.options[0].mid.options?t.options[0].mid.options[e.id]=e.title:t.options[0].mid.o&&(t.options[0].mid.o[e.id]=e.title)),"0"==o.type){var i=s.updateModules({type:"my-module",settings:{mid:e.id,type:0},id:s._module.id},s.getData(s.pid));i&&s.setData(s.pid,i,function(){s.postMessage({type:"preview"})})}}else 0!=e.result&&s.notice("模块保存失败，请重试！","error",2e3);void 0!==a&&a(),s.notice("模块保存成功！","success",2e3),setTimeout(function(){jQuery("#wpcom-panel").removeClass("active")},200)},function(){void 0!==a&&a()}))},saveSetting:function(e,t){_panel_options.settings=e,this.postMessage({type:"preview"}),setTimeout(function(){void 0!==t&&t(),setTimeout(function(){jQuery("#wpcom-panel").removeClass("active")},200)},400)},setData:function(e,t,i){this._page_modules=this._page_modules?this._page_modules:{},this._page_modules[e]=Object.assign([],t),void 0!==i&&i()},getData:function(e){return void 0===e?this._page_modules:this._page_modules[e]},dataFilter:function(e){var t={},i={},o=Object.assign([],_modules[vm.sts.type].options),a=[];o[0]&&o[0]["tab-name"]?a=o:a.push(Object.assign({},_modules[vm.sts.type].options)),e=e.split("&");for(var s=0;s<e.length;s++){var n=e[s].split("="),d=decodeURIComponent(n[0]).match(/(\S+)\[\]$/i);d&&d[1]?(t[d[1]]||(t[d[1]]=[]),t[d[1]].push(decodeURIComponent(n[1]))):t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}for(var r=0;r<a.length;r++)i=this.optionsFilter(a[r],i,t);return i},optionsFilter:function(e,t,i){for(var o in e)if("tab-name"!==o)if("repeat"===e[o].type||"rp"===e[o].type){t[o]=[];var a=e[o].o?e[o].o:e[o].options?e[o].options:e[o].items;for(var s in a)for(var n in i){var d=n.match(/(\S+)\[(\d+)\]/i);d&&d[1]==s&&(t[o][d[2]]||(t[o][d[2]]={}),t[o][d[2]][s]=i[n])}}else if("wrapper"===e[o].type||"w"===e[o].type){a=e[o].o?e[o].o:e[o].options?e[o].options:e[o].items;t=this.optionsFilter(a,t,i)}else void 0!==i[o]&&(e[o].mobile?(t[o]=void 0!==i[o+"__pc"]?i[o+"__pc"]:i[o],void 0!==i[o+"__mobile"]&&(t[o+"_mobile"]=i[o+"__mobile"])):t[o]=i[o]);return t},updateModules:function(e,t){if(t)for(var i=0;i<t.length;i++){if(t[i].id==e.id){t[i]=e;break}if(t[i]&&t[i].settings){var o="";if(t[i].settings.girds?o="girds":t[i].settings.modules&&(o="modules"),"modules"===o&&t[i].settings[o]&&(t[i].settings[o]=this.updateModules(e,Object.assign([],t[i].settings[o]))),"girds"===o&&t[i].settings[o])for(var a in t[i].settings[o])t[i].settings[o][a]=this.updateModules(e,Object.assign([],t[i].settings[o][a]))}}return t},postMessage:function(e,t){(t=void 0!==t?t:document.getElementById("ve-iframe").contentWindow).postMessage(JSON.parse(JSON.stringify(e)),"*")},onMessage:function(e,t){void 0===t&&"function"==typeof e&&(t=e,e=window),e.addEventListener("message",function(e){if(e.origin!==window.location.origin)return!1;t&&"function"==typeof t&&t(e)},!1)},notice:function(e,t,i){var o=jQuery("#ve-notice"),a="",s=this;switch(o.removeClass("active"),this.nTimer&&clearTimeout(this.nTimer),t){case"success":a='<i class="material-icons success">&#xe92d;</i>';break;case"error":a='<i class="material-icons error">&#xe001;</i>';break;case"loading":default:a='<svg class="ve-notice-loading-svg" viewBox="22 22 44 44"><circle class="ve-notice-loading-circle" cx="44" cy="44" r="20.2" fill="none" stroke-width="3.6"></circle></svg>'}var n='<span class="ve-notice-icon">'+a+"</span>";n+="<span>"+e+"</span>",setTimeout(function(){o.html(n).addClass("active"),i&&(s.nTimer=setTimeout(function(){o.html(n).removeClass("active")},i))},270)}},window.VE=new o,setTimeout(function(){VE.notice("开始加载编辑区页面")},300)},{}]},{},[1]);